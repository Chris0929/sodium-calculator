<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CKD Nutrient Analyzer</title>
  <style>
    body {
      background: #fef6f0;
      font-family: Arial, sans-serif;
      color: #333;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #a0522d;
    }
    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fffaf5;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #ffa07a;
      color: white;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background-color: #fff5ec;
      border: 1px solid #e0cfc3;
    }
    .alert {
      color: #d9534f;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>CKD Nutrient Analyzer</h1>

  <p>
    For someone with CKD stage 3, recommended daily limits:<br>
    - Sodium: ~2000 mg<br>
    - Potassium: 2000–4000 mg<br>
    - Protein: 47–51 g<br>
    - Phosphorus: 800–1000 mg
  </p>

  <textarea id="input" placeholder="e.g. 1 tsp salt, 2 tbsp ketchup"></textarea>
  <button onclick="analyze()">Analyze</button>

  <div class="result" id="result"></div>

  <script>
    const nutrientDB = {
      "salt": { per: "tsp", weight: 6, sodium: 2325, potassium: 0, protein: 0, phosphorus: 0 },
      "ketchup": { per: "tbsp", weight: 15, sodium: 160, potassium: 80, protein: 0.2, phosphorus: 3 },
      "soy sauce": { per: "tbsp", weight: 15, sodium: 879, potassium: 55, protein: 1.0, phosphorus: 20 },
      "ranch dressing": { per: "tbsp", weight: 15, sodium: 150, potassium: 20, protein: 0.3, phosphorus: 15 },
      "peanut butter": { per: "tbsp", weight: 16, sodium: 76, potassium: 208, protein: 3.6, phosphorus: 50 },
      // More items to be added here up to 150
    };

    const unitToGrams = {
      "tsp": 4.93,
      "tbsp": 14.79,
      "cup": 240,
      "oz": 28.35,
      "g": 1,
      "ml": 1
    };

    function analyze() {
      const input = document.getElementById("input").value.trim().toLowerCase();
      const lines = input.split(/[,\n]+/);
      let totals = { sodium: 0, potassium: 0, protein: 0, phosphorus: 0 };
      let output = "";

      for (let line of lines) {
        const match = line.trim().match(/(\d+(\.\d+)?)\s*(tsp|tbsp|cup|oz|g|ml)?\s*(.+)/);
        if (match) {
          const qty = parseFloat(match[1]);
          const unit = match[3] || "g";
          const item = match[4].trim();
          const data = nutrientDB[item];

          if (data) {
            const baseWeight = data.weight; // grams in one serving
            const inputWeight = unitToGrams[unit] * qty;
            const ratio = inputWeight / baseWeight;

            const sodium = data.sodium * ratio;
            const potassium = data.potassium * ratio;
            const protein = data.protein * ratio;
            const phosphorus = data.phosphorus * ratio;

            totals.sodium += sodium;
            totals.potassium += potassium;
            totals.protein += protein;
            totals.phosphorus += phosphorus;

            output += `<p><strong>${qty} ${unit} ${item}</strong>: Sodium ${sodium.toFixed(1)} mg, Potassium ${potassium.toFixed(1)} mg, Protein ${protein.toFixed(1)} g, Phosphorus ${phosphorus.toFixed(1)} mg</p>`;
          } else {
            output += `<p><strong>${item}</strong>: Not in database</p>`;
          }
        }
      }

      output += `<hr><p><strong>Total:</strong><br>Sodium: ${totals.sodium.toFixed(1)} mg<br>Potassium: ${totals.potassium.toFixed(1)} mg<br>Protein: ${totals.protein.toFixed(1)} g<br>Phosphorus: ${totals.phosphorus.toFixed(1)} mg</p>`;

      if (totals.sodium > 2000 || totals.protein > 51 || totals.phosphorus > 1000 || totals.potassium > 4000) {
        output += `<p class='alert'>⚠️ One or more nutrients exceed recommended CKD limits.</p>`;
      }

      document.getElementById("result").innerHTML = output;
    }
  </script>
</body>
</html>
