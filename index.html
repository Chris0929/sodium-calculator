<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CKD Nutrient Analyzer</title>
  <style>
    body {
      background-color: #fef6f0;
      font-family: Arial, sans-serif;
      color: #333;
      padding: 20px;
    }
    h1 {
      color: #4e766d;
    }
    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      font-size: 1em;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      background-color: #a8d5ba;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
    }
    button:hover {
      background-color: #91c3a2;
    }
    .result, .recommendation {
      margin-top: 20px;
      background-color: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .alert {
      color: #b33636;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>CKD Nutrient Analyzer</h1>

  <div class="recommendation">
    <p><strong>Sodium:</strong> ~2,000mg/day. Always consult a doctor or registered dietitian.</p>
    <p><strong>Protein:</strong> 47–51g/day for those without diabetes, based on KDOQI guidelines (0.55–0.6g/kg/day).</p>
    <p><strong>Calories:</strong> 2116–2962/day depending on activity and body size.</p>
    <p><strong>Potassium:</strong> 2–4g/day (51–102 mmol/day) as per National Kidney Foundation.</p>
    <p><strong>Phosphorus:</strong> 800–1,000mg/day to avoid blood buildup.</p>
  </div>

  <textarea id="foodInput" placeholder="Enter food items and quantity (e.g., 1 cup rice, 100g chicken)..."></textarea>
  <button onclick="analyzeFood()">Analyze</button>

  <div class="result" id="results"></div>

  <script>
    const apiKey = "TP6duc7H0lDuNEKyPrpR49mtr5dJqTNwYw8vjgKZ";

    async function analyzeFood() {
      const input = document.getElementById("foodInput").value;
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "Loading...";

      try {
        const response = await fetch("https://api.nal.usda.gov/fdc/v1/foods/search?query=" + encodeURIComponent(input) + "&pageSize=1&api_key=" + apiKey);
        const data = await response.json();

        if (!data.foods || data.foods.length === 0) {
          resultsDiv.innerHTML = "<p>No food item found. Try something more specific.</p>";
          return;
        }

        const food = data.foods[0];
        const nutrients = food.foodNutrients;

        let sodium = 0, potassium = 0, protein = 0, phosphorus = 0;

        nutrients.forEach(n => {
          switch (n.nutrientName.toLowerCase()) {
            case "sodium, na": sodium = n.value; break;
            case "potassium, k": potassium = n.value; break;
            case "protein": protein = n.value; break;
            case "phosphorus, p": phosphorus = n.value; break;
          }
        });

        let alerts = [];
        if (sodium > 2000) alerts.push("Sodium exceeds 2,000mg/day");
        if (potassium > 4000) alerts.push("Potassium exceeds 4,000mg/day");
        if (protein > 51) alerts.push("Protein exceeds 51g/day");
        if (phosphorus > 1000) alerts.push("Phosphorus exceeds 1,000mg/day");

        resultsDiv.innerHTML = `
          <h3>Result for: ${food.description}</h3>
          <ul>
            <li><strong>Sodium:</strong> ${sodium.toFixed(1)} mg</li>
            <li><strong>Potassium:</strong> ${potassium.toFixed(1)} mg</li>
            <li><strong>Protein:</strong> ${protein.toFixed(1)} g</li>
            <li><strong>Phosphorus:</strong> ${phosphorus.toFixed(1)} mg</li>
          </ul>
          ${alerts.length ? `<p class="alert">⚠️ ${alerts.join("; ")}</p>` : "<p>No alerts. Nutrients within suggested range.</p>"}
        `;
      } catch (error) {
        resultsDiv.innerHTML = "<p>Something went wrong. Please try again.</p>";
        console.error(error);
      }
    }
  </script>
</body>
</html>
